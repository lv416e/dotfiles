#!/bin/bash
# Update chezmoi and system packages
# Usage: chezmoi-update

set -e

echo "ğŸ”„ Updating system packages..."
echo ""

echo "ğŸ“¦ Updating Homebrew..."
brew update

echo ""
echo "â¬†ï¸  Upgrading Homebrew packages..."
# Continue even if some packages fail to upgrade
brew upgrade || {
    echo "âš ï¸  Some packages failed to upgrade, but continuing..."
}

echo ""
echo "ğŸ§¹ Cleaning up Homebrew..."
brew cleanup

echo ""
echo "ğŸ”„ Updating mise tools..."
mise install || echo "âš ï¸  Some mise tools failed to install, but continuing..."
mise upgrade || echo "âš ï¸  Some mise tools failed to upgrade, but continuing..."
mise prune -y

echo ""
echo "ğŸ”„ Updating chezmoi and applying changes..."
chezmoi update

echo ""
echo "âœ… All updates complete!"
echo ""
echo "ğŸ“Š Summary:"
formula_count=$(brew list --formula | wc -l | xargs)
cask_count=$(brew list --cask | wc -l | xargs)
brew_total=$((formula_count + cask_count))
mise_count=$(mise list | wc -l | xargs)
echo "  - Homebrew formulae: $formula_count"
echo "  - Homebrew casks: $cask_count"
echo "  - Homebrew total: $brew_total packages"
echo "  - mise tools: $mise_count"
echo "  - Dotfiles: managed by chezmoi"
