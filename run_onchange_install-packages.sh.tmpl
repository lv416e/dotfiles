#!/bin/bash
# Install Homebrew packages from Brewfile
# This script runs when the Brewfile changes
# Brewfile hash: {{ include "dot_Brewfile.tmpl" | sha256sum }}

set -eufo pipefail

# Check if Homebrew is installed
if ! command -v brew >/dev/null 2>&1; then
    echo "Installing Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

# Install packages from Brewfile
if [ -f "$HOME/.Brewfile" ]; then
    echo "Installing packages from Brewfile..."
    if brew bundle --file="$HOME/.Brewfile"; then
        echo "Successfully installed packages from Brewfile"
    else
        echo "Warning: Some packages may have failed to install, but continuing..."
        echo "You can manually run: brew bundle --file=\"$HOME/.Brewfile\""
    fi
else
    echo "Brewfile not found, skipping package installation"
fi