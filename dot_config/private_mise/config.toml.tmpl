# =============================================================================
# Mise Configuration - Development Tools & Environment Management
# =============================================================================
# Docs: https://mise.jdx.dev/

[tools]
# Language runtimes
node = "lts"           # Node.js LTS version
python = "3.13"        # Python 3.13 (stable)
go = "latest"          # Latest Go version
ruby = "3.3"           # Ruby 3.3
java = "temurin-11"    # Java 11 (Temurin LTS, supported until 2029)
rust = "stable"        # Rust stable (managed by mise instead of rustup)

# npm global packages
"npm:@anthropic-ai/claude-code" = "latest"  # Claude Code CLI
"npm:@google/gemini-cli" = "latest"         # Gemini CLI
"npm:@openai/codex" = "latest"              # OpenAI Codex CLI
"npm:@slidev/cli" = "latest"                # Slidev presentation tool
"npm:git-open" = "latest"                   # Open GitHub repo from terminal
"npm:ccusage" = "latest"                    # Claude Code usage tracker

# Python tools (pipx/uvx)
"pipx:claude-monitor" = "latest"            # Claude Code usage monitor

# Modern shell (experimental)
"cargo:nu" = "latest"                       # Nushell - modern shell with structured data

[settings]
experimental = true

# =============================================================================
# Task Runner - Development Workflow Automation
# =============================================================================
# Run: mise <task> or mise run <task>
# List: mise tasks
#
# Naming Convention:
#   [category]-[action]  (e.g., sys-update, dot-apply)
#
# Categories:
#   sys-  : System maintenance (update, clean, check)
#   dot-  : Dotfiles management (apply, backup, diff)
#   tool- : Tool management (install, outdated)

# --- System Maintenance ---

[tasks.sys-update]
description = "[sys] Update all tools and prune old versions"
alias = "up"
run = ["mise upgrade", "mise prune -y"]

[tasks.sys-clean]
description = "[sys] Clean all caches (sheldon, zsh, mise)"
alias = "c"
run = [
  "rm -rf ~/.cache/sheldon",
  "rm -rf ~/.zcompdump*",
  "mise cache clear"
]

[tasks.sys-check]
description = "[sys] Verify mise installation and config"
alias = "chk"
run = "mise doctor"

[tasks.sys-health]
description = "[sys] Run comprehensive health checks"
alias = "h"
run = [
  "echo '=== Mise ==='",
  "mise doctor",
  "echo '\n=== Homebrew ==='",
  "brew doctor",
  "echo '\n=== Chezmoi ==='",
  "chezmoi verify",
]

[tasks.sys-status]
description = "[sys] Show system status (tools, caches)"
alias = "st"
run = [
  "echo '=== Installed Tools ==='",
  "mise ls",
  "echo '\n=== Cache Status ==='",
  "du -sh ~/.cache/sheldon 2>/dev/null || echo 'No sheldon cache'",
  "du -sh ~/.zcompdump* 2>/dev/null || echo 'No zsh cache'",
]

[tasks.sys-bench]
description = "[sys] Benchmark zsh startup time (10x)"
alias = "b"
run = "bash -c 'for i in {1..10}; do /usr/bin/time -p zsh -i -c exit 2>&1 | /usr/bin/grep real; done'"

# --- Dotfiles Management ---

[tasks.dot-apply]
description = "[dot] Apply dotfiles to system"
alias = "a"
run = "chezmoi apply"

[tasks.dot-backup]
description = "[dot] Push dotfiles to remote repo"
alias = "bak"
run = "chezmoi git -- push"

[tasks.dot-status]
description = "[dot] Show git status of dotfiles"
alias = "s"
run = "chezmoi git -- status"

[tasks.dot-diff]
description = "[dot] Show diff between source and applied"
alias = "d"
run = "chezmoi diff"

# --- Tool Management ---

[tasks.tool-install]
description = "[tool] Install all tools from config"
alias = "i"
run = "mise install"

[tasks.tool-outdated]
description = "[tool] Check for outdated tools"
alias = "out"
run = "mise outdated"

# --- Workflows (Complex Operations) ---

[tasks.sync]
description = "[workflow] Full sync: apply → update → clean"
alias = "sy"
depends = ["dot-apply", "sys-update", "sys-clean"]

[tasks.fresh]
description = "[workflow] Fresh start: clean → apply → update"
alias = "f"
run = [
  "mise run sys-clean",
  "mise run dot-apply",
  "mise run sys-update",
]
